<form [formGroup]="form()">
  <div class="accordion-container">

    @for (field of fields(); track field.key) {

      @if (field.controlType === 'formGroup' && field.groupFields) {
        <div class="accordion-item" [class.active]="activeAccordionKey === field.key">

          <div class="accordion-header" (click)="toggleAccordion(field.key)">
            <h5 class="mb-0">{{ field.label | translate }}</h5>
            <i class="accordion-icon fas fa-chevron-down"></i>
          </div>

          <div class="accordion-content">
            <div class="accordion-content-inner">
              <div [formGroupName]="field.key" class="row">

                @for (groupField of field.groupFields; track groupField.key) {
                  <div [class]="groupField.classColumn">
                    <app-dynamic-field
                      [field]="groupField"
                      [formGroup]="getFormGroup(field.key)"
                    ></app-dynamic-field>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      } @else {
        <div [class]="'mb-3 ' + field.classColumn">
          <app-dynamic-field [field]="field" [formGroup]="form()"></app-dynamic-field>
        </div>
      }
    }
  </div>
</form>
